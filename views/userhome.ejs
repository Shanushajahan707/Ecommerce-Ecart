<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>E-cart</title>
  <!-- MDB icon -->
  <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <link rel="stylesheet" href="/style/mdb.min.css" />
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

  <style>
    .dropdown:hover .dropdown-menu {
      display: block;
    }

    .dropdown-menu {
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .dropdown-menu {
      min-width: auto;
    }

    .dropdown-item {
      width: 100%;
      box-sizing: border-box;
    }

    .notification-circle {
      width: 1rem;
      height: 1rem;
      background-color: red;
      border-radius: 50%;
      top: 10px;
      position: absolute;
      right: 4vw;
    }

    .carousel-inner {
      height: 60vh;
      padding: 2rem;
    }

    .carousel-inner img {
      height: 58vh;
      background-size: contain;
    }

    #suggestions-container {
      position: absolute;
      top: 100%;
      left: 0;
      width: calc(100% - 2px);
      /* Adjust the width to fit the input */
      padding-left: 10px;
      background-color: #fff;
      border: 1px solid #ced4da;
      border-radius: 0 0 0.25rem 0.25rem;
      z-index: 1000;
      max-height: 200px;
      overflow-y: auto;
      display: none;
    }

    .suggestion-item {
      padding: 0.5rem;
      cursor: pointer;
    }

    .suggestion-item:hover {
      background-color: #f8f9fa;
    }
  </style>
</head>

<body>
  <!-- Start your project here-->
  <!--Main Navigation-->
  <header>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light ">
      <!-- Container wrapper -->
      <div class="container-fluid mx-3">
        <!-- Toggle button -->
        <button class="navbar-toggler" type="button" data-mdb-toggle="collapse"
          data-mdb-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
          aria-label="Toggle navigation">
          <i class="fas fa-bars"></i>
        </button>

        <!-- Collapsible wrapper -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <!-- Navbar brand -->
          <a class="navbar-brand mt-2 mt-lg-0" href="#">
            <!-- <img src="img/[removal.ai]_c4d2c10c-7940-48dc-90a4-b90aa8006f6e-screenshot-2023-10-27-203006.png" style="width: 6vw; height: 9vh;" alt="MDB Logo"
            loading="lazy" /> -->
            <h3>E- <span style="color: red;">CART</span></h3>
          </a>
          <!-- Left links -->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/categorylist">Shop</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#footer">About </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#footer">Contact </a>
            </li>
          </ul>
          <a href="/wishlistpage"> <i class="fas fa-heart" style="font-size:3vh;  margin-right: 2rem;"></i></a>
          <div style="position: relative;">
            <a href="/cartitems" data-mdb-toggle="tooltip" data-mdb-placement="bottom" title="Cart">
              <i class="fas fa-cart-shopping" style="font-size:3vh; margin-right: 3rem;">
                <% if (cartcount) { %>
                  <div class="notification-circle"
                    style="font-size: 0.8rem; text-align:center;color: black;padding-top: 3px;">
                    <%= cartcount %>
                  </div>
                  <% } else { %>
                    <div></div>
                    <% } %>
              </i>
            </a>
          </div>



          <form class="d-flex input-group w-auto me-4 ">
            <input id="search" type="search " class="form-control rounded" placeholder="Search Products"
              aria-label="Search" aria-describedby="search-addon" oninput="searchFunction()" autocomplete="off" />
          </form>
          <div id="suggestions-container" class="suggestions-container"></div>
          <!-- Left links -->
        </div>
        <!-- Collapsible wrapper -->
        <!-- Avatar -->
        <div class="dropdown">
          <a href="/userprofile" class="btn btn-secondary" id="profileDropdown" role="button">
            <i class="fas fa-circle-user" style="font-size: 1.5em; margin-right: 0.5rem;"></i> Account
          </a>
        </div>



        <!-- </a>
        
      </div> -->

        <!-- Right elements -->
      </div>
      <!-- Container wrapper -->
    </nav>
    <!-- Navbar -->

  </header>
  <!--carousel-->
  <div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="\img\Banner 2.jpg" class="d-block w-100" alt="...">
      </div>
      <div class="carousel-item">
        <img src="\img\Banner 3.jpg" class="d-block w-100" alt="...">
      </div>
      <div class="carousel-item">
        <img src="\img\Banner 4.jpg" class="d-block w-100" alt="...">
      </div>
    </div>
    <a class="carousel-control-prev" href="#carouselExampleFade" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleFade" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
  <!--carousel -->
  <hr class="hr hr-blurry" />
  <!--Card Phones-->
  <div>
    <p class="text-center fw-bold fs-1">New Phones</p>
  </div>

  <div class="container-fluid d-flex flex-wrap">
    <% if(datas.length> 0) { %>
      <% for(let i=0; i < datas.length && i < 4; i++) { %> <!-- Check the length of 'datas' -->
        <% if (datas[i]) { %>
          <div class="card mb-3 col-12 col-sm-6 col-md-4 col-lg-3 ">
            <img style="height: 50vh; object-fit: cover;" src="<%= datas[i].image[0] %>" class="card-img-top"
              alt="Fissure in Sandstone" />
            <div class="card-body">
              <h5 class="card-title">
                <%= datas[i].Productname %>
              </h5>
              <p class="card-text">₹
                <%= datas[i].Price %>
              </p>
              <a href="/seeproductwithacc/<%= datas[i]._id %>" class="btn btn-primary">View More</a>
              <!-- <a href="/addcart/<%= datas[i]._id %>" class="btn btn-info float-end">Add To Cart</a> -->
              <button class="btn btn-link wishlist-btn" onclick="toggleWishlist('<%= datas[i]._id %>')">
                <% if(wishlistProducts.some(wishlistProduct=> wishlistProduct._id.equals(datas[i]._id))) { %>
                  <i class="fa-solid fa-heart" id="fa-heart<%= datas[i]._id %>"></i>
                  <% } else { %>
                    <i class="fa-regular fa-heart" id="fa-heart<%= datas[i]._id %>"></i>
                             <% } %>
                             
              </button>
            </div>
          </div>
          <% } %>
            <% } %>
              <% } %>
  </div>

  <!--Card Phones-->
  <hr class="hr hr-blurry" />
  <img src="\img\second banner.jpg" class="img w-100" style="height: 30rem;" alt="Error In Image" />
  <hr class="hr hr-blurry" />
  <!--Card Laptop-->




  <!--Card Laptop-->
  <hr class="hr hr-blurry" />
  <!--Card Home Applliants-->





  <!-- Footer -->
  <footer class="text-center text-lg-start bg-light text-muted">
    <!-- Section: Social media -->
    <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
      <!-- Left -->
      <div class="me-5 d-none d-lg-block">
        <span>Get connected with us on social networks:</span>
      </div>
      <!-- Left -->

      <!-- Right -->
      <div>
        <a href="https://www.facebook.com/" class="me-4 text-reset">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="https://www.instagram.com/____shxnu/" class="me-4 text-reset">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://www.linkedin.com/in/shanushajahan/" class="me-4 text-reset">
          <i class="fab fa-linkedin"></i>
        </a>
        <a href="https://github.com/Shanushajahan707/Ecommerce-Ecart/tree/master" class="me-4 text-reset">
          <i class="fab fa-github"></i>
        </a>
      </div>
      <!-- Right -->
    </section>
    <!-- Section: Social media -->

    <!-- Section: Links  -->
    <section class="" id="footer">
      <div class="container text-center text-md-start mt-5">
        <!-- Grid row -->
        <div class="row mt-3">
          <!-- Grid column -->
          <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
            <!-- Content -->
            <h6 class="text-uppercase fw-bold mb-4">
              <i class="fas fa-gem me-3"></i>Company name
            </h6>
            <p>
              This the E-commerce project
            </p>
          </div>
          <!-- Grid column -->

          <!-- Grid column -->

          <!-- Grid column -->

          <!-- Grid column -->
          <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
            <!-- Links -->
            <h6 class="text-uppercase fw-bold mb-4">
              Useful links
            </h6>
            <p>
              <a href="/userprofile" class="text-reset">Profile</a>
            </p>
            <p>
              <a href="/categorylist" class="text-reset">Shop</a>
            </p>
          </div>
          <!-- Grid column -->

          <!-- Grid column -->
          <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
            <!-- Links -->
            <h6 class="text-uppercase fw-bold mb-4">Contact</h6>
            <p><i class="fas fa-home me-3"></i> Kollam,Punalur</p>
            <p>
              <i class="fas fa-envelope me-3"></i>
              shanushajahan@gmail.com
            </p>


          </div>
          <!-- Grid column -->
        </div>
        <!-- Grid row -->
      </div>
    </section>
    <!-- Section: Links  -->

    <!-- Copyright -->
    <div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
      © 2023 Copyright:
      <a class="text-reset fw-bold" href="/">Ecart</a>
    </div>
    <!-- Copyright -->
  </footer>
  <!-- Footer -->
  <!-- End your project here-->

  <!-- MDB -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const addToCartButtons = document.querySelectorAll('.add-to-cart');

      addToCartButtons.forEach(button => {
        button.addEventListener('click', function (event) {
          event.preventDefault();

          const productId = this.getAttribute('data-product-id');

          // Make an AJAX request
          fetch(`/addcart/${productId}`, {
            method: 'POST', // or 'GET' depending on your server-side implementation
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({}), // You can include data if needed
          })
            .then(response => response.json())
            .then(data => {
              // Handle the response, if needed
              console.log(data);
            })
            .catch(error => {
              console.error('Error:', error);
            });
        });
      });
    });
  </script>
  <script>
    function toggleWishlist(productid) {
      const icon = document.getElementById(`fa-heart${productid}`);
      if (icon && icon.classList.contains('fa-regular')) {
        fetch(`/addtowishlist/${productid}`)
          .then(() => {
            console.log('clicked wihs');
            icon.classList.remove('fa-regular');
            icon.classList.add('fa-solid');
          })
          .catch(error => {
            console.error('Error:', error);
          });

        // icon.style.color = '#ff291a';
        // Logic to handle adding the product to the wishlist...
      } else if (icon) {
        fetch(`/removewishlist/${productid}`)
          .then(() => {
            icon.classList.remove('fa-solid');
            icon.classList.add('fa-regular');
          })
          .catch(error => {
            console.error('Error:', error);
          });

        // Logic to handle removing the product from the wishlist...
      }
    }

    function searchFunction() {
      const searchInput = document.getElementById('search').value;
      // Make an AJAX request to your server with the search query
      fetch(`/search?search=${searchInput}`)
        .then(response => response.json())
        .then(data => {
          // Update the suggestions box with the received data
          const suggestionsContainer = document.getElementById('suggestions-container');
          suggestionsContainer.innerHTML = ''; // Clear previous suggestions

          if (data.products.length > 0 || data.categories.length > 0) {
            data.products.forEach(product => {
              const suggestionDiv = document.createElement('div');
              suggestionDiv.classList.add('suggestion-item', 'larger-size');
              suggestionDiv.textContent = product.Productname;
              suggestionDiv.addEventListener('click', () => {
                window.location.href = `/seeproductwithacc/${product._id}`;
              });
              suggestionsContainer.appendChild(suggestionDiv);
            });

            data.categories.forEach(category => {
              const suggestionDiv = document.createElement('div');
              suggestionDiv.classList.add('suggestion-item', 'larger-size');
              suggestionDiv.textContent = category.Category;
              suggestionDiv.addEventListener('click', () => {
                window.location.href = `/categorylist`;
              });
              suggestionsContainer.appendChild(suggestionDiv);
            })
            suggestionsContainer.style.display = 'block';
          } else {
            const noSuggestionDiv = document.createElement('div');
            noSuggestionDiv.classList.add('suggestion-item', 'larger-size');
            noSuggestionDiv.textContent = 'No products found.';
            suggestionsContainer.appendChild(noSuggestionDiv);
            suggestionsContainer.style.display = 'block';
          }
          document.addEventListener('click', handleClickOutside);
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }
  </script>

  <script type="text/javascript" src="js/mdb.min.js"></script>
  <!-- Custom scripts -->
  <script type="text/javascript"></script>
</body>

</html>
